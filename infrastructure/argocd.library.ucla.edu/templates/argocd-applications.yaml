{{- if .Values.argocd_applications.entries }}
{{- range $v := .Values.argocd_applications.entries }}
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: {{ $v.name }}
  namespace: {{ $.Values.argocd_applications.argocd_namespace }}
  annotations:
{{ $v.annotations | default dict | toYaml| indent 4 }}
spec:
  syncPolicy:
{{ $v.syncPolicy | default $.Values.argocd_applications.default_sync_policy.syncPolicy | toYaml | indent 4 }}
  project: {{ $v.project }}
  destination:
    server: {{ $v.destination }}
    namespace: {{ $v.deployment_namespace }}
  {{- if $v.sources }}
  {{- range $w := $v.sources }}
  sources:
    - repoURL: {{ $w.repourl }}
      targetRevision: {{ $w.revision }}
      {{- if $w.path }}
      path: {{ $w.path }}
      {{ else }}
      chart: {{ $w.chart }}
      {{- end }}
  {{- end }}
  {{- end }}
{{- end }}
{{- end }}
